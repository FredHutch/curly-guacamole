# Berkshelf Management

`berkshelf` manages cookbook dependencies, allows liberal use of 3rd party
cookbooks without losing one's sanity

  - Using community cookbooks quickly leads to dependency hell
  - Declare dependencies and let `berks` sort out which versions are required

---

# Berkshelf Management

## Basic `Berksfile`:

  - created by `chef generate cookbook`

```
source 'https://supermarket.chef.io'

metadata
```
  - indicates url of a server running the supermarket API
  - indicates that dependencies are located in the `metadata.rb` file

```
source 'https://knife.fhcrc.org'
source 'https://supermarket.chef.io'

metadata
```

  - this file adds the URL of the local supermarket with our cookbooks

---

# Berkshelf Management

  - `berks` reads `metadata.rb` and starts walking the dependencies
    - first the ones declared in the file
    - then the dependencies for each of those
    - iterate till no more dependencies declared

  ![:scale 100%](img/graph.png)

> This graph is generated by `berks viz`, using `graphviz` as the back-end for
> creating the image

---

# Berkshelf Management

## Building the Lockfile

  - `Berksfile.lock` is a file containing a graph indicating cookbooks and
    versions required
    - The text version of the image shown in the last slide
  - `berks install` and `berks update` create and manage the file

## Artifact Management

  - `berks upload` uploads the cookbook to the server and freezes it
  - `berks apply <environment>` applies the versions to the environment

---
