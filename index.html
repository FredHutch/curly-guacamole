<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Presentation Title</title>
    <meta name="description" content="Some description about the slides">
    <meta name="author" content="You">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <textarea id="source">class: center, middle

# Clever Title

---
# Agenda

1. Chef Policy Objects
2. High Level Workflow

---
# Policy objects

 - role + cookbooks + environment = policy

## Role:
  - name
  - attributes
  - run list\*

## Environment
  - name
  - attributes
  - cookbook versions\*

---
# The Berkshelf Way

berks manages cookbook dependencies, allows sane use of 3rd party cookbooks in
our ecosystem

---

# Basic `Berksfile`:

  - created by `chef generate cookbook`

```
source 'https://supermarket.chef.io'

metadata
```
  - indicates url of a server running the supermarket API
  - indicates that dependencies are located in the `metadata.rb` file

---

# Berks-ing

## Building the Lockfile

  - `Berksfile.lock` is a file containing a graph indicating cookbooks and
    versions required
  - `berks install` and `berks update` create and manage the file

## Updating the Chef Server

  - `berks upload` uploads the cookbook version to the server and freezes it
  - `berks apply <environment>` applies the versions to the environment

---

# What Berks is Managing

  ![:scale 100%](img/graph.png)

> This graph is generated by `berks viz`, using `graphviz` as the back-end for
> creating the image

---

# SciComp Patterns

## _role recipe_ pattern

  - the _role_ object is defined on the server with only the _role recipe_'s
    default recipe in the run list
  - the _role recipe_ runs additional recipes as necessary to configure the
    components for the role

## _environment recipe_ pattern

  - Very similar to an application cookbook
  - Contains only dependencies on our role cookbooks
  - Berksfile.lock is checked into SCM
  - One environment per branch (e.g. prod, dev, test, etc.)

---
# Development

  - Precise tasks depend on the need
  - Adding new hosts to existing roles- just bootstrap
  - A new application- develop a new role
  - Extending or changing an existing role?
    - Update the role or library cookbooks
    - Rev the cookbook
    - Update the environment, indicate the new role version

---

# Closing Notes

  - This is a significant change in how we do business
  - In the words of Haagrid: "Yer a developer, 'arry"
  - Stop thinking of isolated changes, rather releases
  - Think about collaboration with application devs
    - Think about handing off management to application devs!


    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js"></script>
    <script>window.remark || document.write(
  '<script src="js/vendor/remark.min.js"><\/script>'
)

    </script>
    <script src="js/vendor/remark-language.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>